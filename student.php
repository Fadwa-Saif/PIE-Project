<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Stagiaire</title>
    <style>
        /* Copy the root and basic styles from login.html */
        /* Add these new styles */
    /* ... existing root variables ... */
    :root {
        --primary-color: #2c5282;
        --secondary-color: #4299e1;
        --background-color: #f7fafc;
        --text-color: #2d3748;
    }

    .quiz-section {
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(44, 82, 130, 0.1);
        padding: 2rem;
        margin: 2rem auto;
        max-width: 1000px;
    }

    .question {
        background: #f8fafc;
        border-left: 4px solid var(--primary-color);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-radius: 0 10px 10px 0;
        transition: transform 0.3s ease;
    }

    .question:hover {
        transform: translateX(5px);
    }

    .question h3 {
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    input[type="text"], textarea {
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        padding: 0.8rem;
        transition: all 0.3s ease;
    }

    input[type="text"]:focus, textarea:focus {
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        outline: none;
    }

    .cause-entry {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem;
        border-radius: 6px;
        transition: background-color 0.2s;
    }

    .checkbox-group label:hover {
        background-color: #edf2f7;
    }

    .add-cause-btn {
        background: var(--secondary-color);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .add-cause-btn:hover {
        background: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
    }

    .submit-btn {
        background: rgb(122, 160, 231);
        color: whitesmoke;
        padding: 1rem 2rem;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        width: 100%;
        margin-top: 2rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .submit-btn:hover {
        background: #2c5282;
        color: #e2e8f0;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(44, 82, 130, 0.25);
    }

    .submit-btn:active {
        transform: translateY(1px);
    }

    .action-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
    }

    .action-table th {
        background: var(--primary-color);
        color: white;
        padding: 1rem;
        text-align: left;
    }

    .action-table td {
        padding: 1rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .action-table tr:last-child td {
        border-bottom: none;
    }

    .action-table tr:hover {
        background-color: #f8fafc;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
        .dashboard {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .info-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .quiz-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .question {
            margin-bottom: 2rem;
        }

        .options {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }

        .option-btn {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-btn:hover {
            border-color: var(--primary-color);
        }

        .option-btn.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .form-grid {
        display: grid;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .action-table {
        width: 100%;
        margin: 1rem 0;
        border-collapse: collapse;
    }

    .action-table td, .action-table th {
        padding: 0.5rem;
        border: 1px solid #e2e8f0;
    }

    textarea {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        resize: vertical;
    }

    .causes-grid {
        display: grid;
        gap: 2rem;
    }

    .cause-entry {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
    }

    .checkbox-group {
        display: grid;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .add-cause-btn {
        background: var(--secondary-color);
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .peer-review-section {
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(44, 82, 130, 0.1);
        padding: 2rem;
        margin: 2rem auto;
        max-width: 1000px;
    }

    .student-selector {
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: var(--background-color);
        border-radius: 10px;
    }

    .random-btn {
        background: var(--primary-color);
        color: white;
        padding: 1rem 2rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .random-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
    }

    .selected-student-card {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .word-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
    }

    .word-input {
        padding: 0.8rem;
        border: 2px solid #e2e8f0;
        border-radius: 6px;
        transition: all 0.3s ease;
    }

    .word-input:focus {
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
        outline: none;
    }

    .submit-description-btn {
        background: var(--secondary-color);
        color: white;
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .descriptions-container {
        display: grid;
        gap: 1rem;
        margin-top: 1rem;
    }

    .description-card {
        background: var(--background-color);
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid var(--primary-color);
    }

    .description-words {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .word-tag {
        background: var(--primary-color);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
    }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="info-card">
            <h2>Informations Personnelles</h2>
            <div id="userInfo">
                <!-- Will be filled by JavaScript -->
            </div>
        </div>

        <!-- ... existing code until quiz section ... -->

<div class="quiz-section">
    <h2>Questionnaire de Réflexion Personnelle</h2>
    <form id="quizForm" onsubmit="submitQuiz(event)">
        <!-- Section 1: Tags personnels -->
        <div class="question">
            <h3>1. Écrivez les 3 mots (tags) que vous voulez que les gens retiennent de vous :</h3>
            <div class="form-group">
                <input type="text" name="tags[]" placeholder="Tag 1" required>
                <input type="text" name="tags[]" placeholder="Tag 2" required>
                <input type="text" name="tags[]" placeholder="Tag 3" required>
            </div>
        </div>

        <!-- Section 2: Actions quotidiennes -->
        <div class="question">
            <h3>2. Actions quotidiennes qui justifient vos tags :</h3>
            <table class="action-table">
                <tr>
                    <th>Tag</th>
                    <th>Action quotidienne</th>
                </tr>
                <tr>
                    <td>Tag 1</td>
                    <td><textarea name="actions[]" required></textarea></td>
                </tr>
                <tr>
                    <td>Tag 2</td>
                    <td><textarea name="actions[]" required></textarea></td>
                </tr>
                <tr>
                    <td>Tag 3</td>
                    <td><textarea name="actions[]" required></textarea></td>
                </tr>
            </table>
        </div>

        <!-- Section 3: Confiance -->
        <div class="question">
            <h3>3. Êtes-vous une personne de confiance ? Expliquez pourquoi :</h3>
            <textarea name="trust_explanation" rows="4" required></textarea>
        </div>

        <!-- Section 4: Mots des collègues -->
        <div class="question">
            <h3>4. Mots écrits par vos collègues :</h3>
            <div class="colleagues-words">
                <div class="form-grid">
                    <input type="text" placeholder="Mot 1" name="colleague_words[]">
                    <input type="text" placeholder="Mot 2" name="colleague_words[]">
                    <input type="text" placeholder="Mot 3" name="colleague_words[]">
                    <!-- ... up to 11 inputs ... -->
                </div>
            </div>
        </div>

        <!-- Section 5: Valeurs personnelles -->
        <div class="question">
            <h3>5. Vos valeurs clés :</h3>
            <div class="values-section">
                <div class="personal-values">
                    <h4>Vos 5 valeurs personnelles :</h4>
                    <div class="form-grid">
                        <input type="text" name="personal_values[]" placeholder="Valeur 1" required>
                        <input type="text" name="personal_values[]" placeholder="Valeur 2" required>
                        <input type="text" name="personal_values[]" placeholder="Valeur 3" required>
                        <input type="text" name="personal_values[]" placeholder="Valeur 4" required>
                        <input type="text" name="personal_values[]" placeholder="Valeur 5" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 6: Causes -->
        <div class="question">
            <h3>6. Causes qui vous tiennent à cœur :</h3>
            <div class="causes-grid">
                <div class="cause-entry">
                    <input type="text" name="causes[]" placeholder="Cause">
                    <textarea name="cause_actions[]" placeholder="Actions concrètes"></textarea>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" name="reading[]"> Je lis sur ce sujet
                        </label>
                        <label>
                            <input type="checkbox" name="news[]"> Je suis l'actualité
                        </label>
                        <label>
                            <input type="checkbox" name="engagement[]"> Je suis engagé(e) dans des groupes
                        </label>
                    </div>
                </div>
                <!-- Add button to add more causes -->
                <button type="button" onclick="addCauseEntry()" class="add-cause-btn">+ Ajouter une cause</button>
            </div>
        </div>

        <button type="submit" class="submit-btn">Soumettre les réponses</button>
        <div class="peer-review-section">
    <h2>Description des Collègues</h2>
    
    <!-- Random student selector -->
    <div class="student-selector">
        <h3>Décrire un Collègue</h3>
        <button onclick="getRandomStudent()" class="random-btn">Choisir un Collègue au Hasard</button>
        <div id="selectedStudent" class="selected-student-card" style="display: none;">
            <h4>Collègue à décrire:</h4>
            <p id="studentName"></p>
            <div class="word-inputs">
                <input type="text" placeholder="Mot 1" class="word-input">
                <input type="text" placeholder="Mot 2" class="word-input">
                <input type="text" placeholder="Mot 3" class="word-input">
                <input type="text" placeholder="Mot 4" class="word-input">
                <input type="text" placeholder="Mot 5" class="word-input">
            </div>
            <button onclick="submitDescription()" class="submit-description-btn">Soumettre la Description</button>
        </div>
    </div>

    </form>
</div>
 <div class="peer-descriptions">
        <h3>Ce que vos collègues disent de vous</h3>
        <div id="myDescriptions" class="descriptions-container">
            <!-- Will be filled with descriptions -->
        </div>
    </div>
</div>

<script>
    // Add this to your existing JavaScript
    function addCauseEntry() {
        const causeTemplate = document.querySelector('.cause-entry').cloneNode(true);
        // Clear the inputs
        causeTemplate.querySelectorAll('input, textarea').forEach(input => input.value = '');
        causeTemplate.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.querySelector('.causes-grid').insertBefore(causeTemplate, document.querySelector('.add-cause-btn'));
    }

    // Modify your existing submitQuiz function to handle the new form data
    async function submitQuiz(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = {
            tags: [...formData.getAll('tags[]')],
            actions: [...formData.getAll('actions[]')],
            trustExplanation: formData.get('trust_explanation'),
            colleagueWords: [...formData.getAll('colleague_words[]')],
            personalValues: [...formData.getAll('personal_values[]')],
            causes: [...document.querySelectorAll('.cause-entry')].map(entry => ({
                cause: entry.querySelector('input[name="causes[]"]').value,
                actions: entry.querySelector('textarea[name="cause_actions[]"]').value,
                reading: entry.querySelector('input[name="reading[]"]').checked,
                news: entry.querySelector('input[name="news[]"]').checked,
                engagement: entry.querySelector('input[name="engagement[]"]').checked
            }))
        };

        try {
            const response = await fetch('http://localhost:5000/api/quiz/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('Réponses soumises avec succès!');
                // Optionally redirect or clear form
            } else {
                alert('Erreur lors de la soumission');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Erreur de connexion au serveur');
        }
    }
    async function getRandomStudent() {
        try {
            const response = await fetch('http://localhost:5000/api/students/random', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            const data = await response.json();
            if (data.student) {
                document.getElementById('selectedStudent').style.display = 'block';
                document.getElementById('studentName').textContent = data.student.name;
                document.getElementById('selectedStudent').dataset.studentId = data.student.id;
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Erreur lors de la sélection d\'un étudiant');
        }
    }

    async function submitDescription() {
        const words = [...document.querySelectorAll('.word-input')].map(input => input.value);
        const studentId = document.getElementById('selectedStudent').dataset.studentId;
        
        if (words.some(word => !word)) {
            alert('Veuillez remplir tous les mots');
            return;
        }

        try {
            const response = await fetch('http://localhost:5000/api/descriptions/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    studentId,
                    words,
                    fromStudent: localStorage.getItem('userName')
                })
            });

            if (response.ok) {
                alert('Description soumise avec succès!');
                document.querySelectorAll('.word-input').forEach(input => input.value = '');
                document.getElementById('selectedStudent').style.display = 'none';
                loadMyDescriptions();
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Erreur lors de la soumission de la description');
        }
    }

    async function loadMyDescriptions() {
        try {
            const response = await fetch(`http://localhost:5000/api/descriptions/${localStorage.getItem('userName')}`);
            const data = await response.json();
            
            const container = document.getElementById('myDescriptions');
            container.innerHTML = data.descriptions.map(desc => `
                <div class="description-card">
                    <p>De: ${desc.fromStudent}</p>
                    <div class="description-words">
                        ${desc.words.map(word => `<span class="word-tag">${word}</span>`).join('')}
                    </div>
                </div>
            `).join('') || '<p>Aucune description pour le moment</p>';
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // Load descriptions when page loads
    window.addEventListener('load', loadMyDescriptions);
</script>
</body>
</html>
